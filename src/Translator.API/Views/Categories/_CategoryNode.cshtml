@model Translator.Application.Features.Category.Queries.GetCategoryTree.Response;
@{
    // Determine if this is a root category by checking ParentId
    var isRoot = !Model.ParentId.HasValue;
    var childrenCount = Model.Children?.Count ?? 0;
    var hasChildren = childrenCount > 0;
}

<div class="tree-node">
    <div class="tree-node-content @(isRoot ? "is-root" : "")">
        <div class="tree-node-header">
            <div class="tree-node-info">
                @if (hasChildren)
                {
                    <button type="button"
                            class="expand-btn"
                            id="expand-@Model.Id"
                            onclick="toggleChildren('@Model.Id')"
                            title="Expand/Collapse">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                }
                else
                {
                    <span style="width: 24px;"></span>
                }

                <div class="tree-node-value">
                    <i class="fas fa-@(isRoot ? "crown" : "sitemap") me-1"></i>
                    @Model.Value
                    
                    @if (!string.IsNullOrWhiteSpace(Model.Shortcode))
                    {
                        <span class="category-shortcode-badge ms-2">@Model.Shortcode</span>
                    }

                    @if (isRoot)
                    {
                        <span class="root-badge">Root</span>
                    }
    
                    <span class="category-type-badge">@Model.TypeName</span>

                    @if (Model.Order.HasValue)
                    {
                        <span class="category-order-badge">Order: @Model.Order</span>
                    }

                    @if (hasChildren)
                    {
                        <span class="children-count">
                            <i class="fas fa-sitemap"></i>
                            @childrenCount
                        </span>
                    }
                </div>
            </div>

            <div class="node-actions">
                <button type="button"
                        class="node-action-btn btn-copy"
                        onclick="copyToClipboard('@Model.Id', this)"
                        title="Copy Category ID">
                    <i class="fas fa-copy"></i>
                </button>

                <button type="button"
                        class="node-action-btn btn-add"
                        onclick="openCreateForm('@Model.Id', '@Html.Raw(Html.Encode(Model.Value))')"
                        title="Add Child Category">
                    <i class="fas fa-plus"></i>
                </button>

                <button type="button"
                        class="node-action-btn btn-edit tree-edit-btn"
                        data-category-id="@Model.Id"
                        data-category-value="@Model.Value"
                        data-category-order="@(Model.Order?.ToString() ?? "")"
                        data-category-metadata="@(Model.Metadata != null ? System.Text.Json.JsonSerializer.Serialize(Model.Metadata) : "")"
                        data-category-shortcode="@(Model.Shortcode ?? "")"
                        title="Edit Category">
                    <i class="fas fa-edit"></i>
                </button>

                <button type="button"
                        class="node-action-btn btn-delete"
                        onclick="showDeleteConfirmation('@Model.Id', '@Html.Raw(Html.Encode(Model.Value))')"
                        title="Delete Category">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Children container (initially hidden) -->
    @if (Model.Children != null && Model.Children.Any())
    {
        <div class="tree-children" id="children-@Model.Id">
            @foreach (var child in Model.Children.OrderBy(c => c.Order ?? int.MaxValue))
            {
                @await Html.PartialAsync("_CategoryNode", child, ViewData)
            }
        </div>
    }
</div>