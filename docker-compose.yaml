
volumes:
  postgres-db:
  redis_data:
  easynmt_cache:

services:
  postgres:
    container_name: PostgresTranslatorDb
    image: postgres:17.3
    ports:
      - '5432:5432'
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - postgres-db:/var/lib/postgresql/data
    restart: always

  redis:
    container_name: redis
    image: redis:7
    ports:
      - '6379:6379'
    volumes:
      - redis_data:/data
    restart: always

  easynmt:
    image: easynmt/api:2.0-cpu     # или easynmt/api:2.0-cuda11.1 для GPU
    container_name: easynmt
    restart: unless-stopped
    ports:
      - "24080:80"                 # <хост>:<контейнер>
    environment:
      # базовая модель Opus-MT (лёгкая, поддерживает грузинский)
      EASYNMT_MODEL: opus-mt
      # кеш всех загруженных весов в томе → не качаются заново
      EASYNMT_CACHE_FOLDER: /cache
      # примеры тонкой настройки
      MAX_WORKERS_BACKEND: 4       # параллельных процессов перевода
      EASYNMT_BATCH_SIZE: 32
    volumes:
      - easynmt_cache:/cache       # постоянный кеш моделей

